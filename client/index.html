<script>
  const API_URL = 'https://your-api.onrender.com/api/requests'; // CHANGE THIS

  let requests = [];
  let myPosition = null;
  let map = null;
  let markersLayer = null;

  // ... (keep all your DOM elements and helpers: haversine, reverseGeocode, etc.)

  // FETCH ALL REQUESTS
  async function fetchRequests() {
    try {
      const res = await fetch(API_URL);
      requests = await res.json();
      initMapAndRender();
    } catch (e) {
      document.getElementById('requestsContainer').innerHTML = `<p class="no-requests">Failed to load requests.</p>`;
    }
  }

  // SUBMIT REQUEST
  document.getElementById('requestForm').addEventListener('submit', async e => {
    e.preventDefault();

    const formData = new FormData();
    formData.append('applianceName', document.getElementById('applianceName').value.trim());
    formData.append('issueDescription', document.getElementById('issueDescription').value.trim());
    formData.append('city', document.getElementById('city').value.trim());
    formData.append('zip', document.getElementById('zip').value.trim());
    if (myPosition) {
      formData.append('lat', myPosition.lat);
      formData.append('lng', myPosition.lng);
    }
    if (photoInput.files[0]) formData.append('image', photoInput.files[0]);

    try {
      const res = await fetch(API_URL, {
        method: 'POST',
        body: formData
      });
      if (res.ok) {
        alert('Request created!');
        e.target.reset();
        preview.src = ''; preview.style.display = 'none';
        currentImage = null; myPosition = null;
        document.getElementById('submitBtn').disabled = true;
        document.querySelector('[data-tab="view"]').click();
      }
    } catch (e) {
      alert('Upload failed. Try again.');
    }
  });

  // On view tab â†’ fetch + render
  document.querySelector('[data-tab="view"]').addEventListener('click', fetchRequests);

  // ... keep your initMapAndRender(), but use `requests` from API
</script>
